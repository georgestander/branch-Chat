2026-01-09 — PRD drafted (UI Sprint). Ref: Docs/PRD.md PRD-UI-001..011. Decisions: desktop-only; min widths 520/360/280; accent blue #1D4ED8; scroll anchors to top of new assistant output; web results must open external sources. Files: Docs/PRD.md, progress.txt. Notes: next = implement layout + highlight navigation + brutalist theme per PRD.
2026-01-09 — UI layout/navigation: branch highlight metadata + parent alignment scroll, sidebar/branch navigate keeps parent open, min widths 520/360/280, removed max-width constraints. PRD: PRD-UI-001/002/003/004/005/007. Files: src/app/shared/markdown.server.ts, src/app/pages/conversation/ConversationPage.tsx, src/app/components/conversation/BranchableMessage.tsx, src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/ConversationComposer.tsx.
2026-01-09 — Added npm scripts for required feedback loops (typecheck/test/lint) to enable mandated runs. Files: package.json.
2026-01-09 — Brutalist UI pass: black/white tokens + blue accent, darker borders, message bubbles + code blocks hardened, composer bar black/white; streaming anchor keeps start visible; web results filtered to external links. PRD: PRD-UI-006/008/009/010/011. Files: src/app/styles.css, src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationComposer.tsx, src/app/components/conversation/ToolInvocationSummary.tsx.
2026-01-09 — Parent pane auto-opens when branch has a parent to preserve origin context. PRD: PRD-UI-004/005. Files: src/app/components/conversation/ConversationLayout.tsx.
2026-01-09 — Created scoping-interviewer skill + packaged .skill. PRD: N/A. Decisions: workflow-based interview; scope.state.json single source; no extra resources. Files: /Users/georgestander/.codex/skills/scoping-interviewer/SKILL.md, /Users/georgestander/.codex/skills/scoping-interviewer.skill, progress.txt. Notes: packaging used local venv for pyyaml.
2026-01-09 — Composer constrained to centered max width again (fixed full-width regression). PRD: PRD-UI-001/011. Files: src/app/components/conversation/BranchColumn.tsx.
2026-01-09 — Composer bar rounded corners restored. PRD: PRD-UI-011. Files: src/app/components/conversation/ConversationComposer.tsx.
2026-01-09 — Composer alignment fixes: tightened footer padding, matched button heights, white help text, rounded controls. PRD: PRD-UI-001/011. Files: src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationComposer.tsx.
2026-01-09 — Composer footer set to black band to remove white gutter; forced white input + caret + help text. PRD: PRD-UI-001/011. Files: src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationComposer.tsx.
2026-01-09 — Split view sizing fix: active (child) stays largest, resize clamps keep active readable, composer aligns to column width. PRD: PRD-UI-001/002. Decisions: cap parent ratio at 45%%; clamp ratio on container resize; allow parent min to soften when constrained. Files: src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx. Notes: none.
- Task: Composer only in active branch (PRD: Core Experience > Branch navigation/composer placement).
- Decisions: remove inactive footer + reduce bottom padding to avoid fake composer space; keep active composer docked in active column for clear focus.
- Files: src/app/components/conversation/BranchColumn.tsx
- Notes: none
- Task: Fix active-branch padding regression (PRD: Core Experience > Branch navigation).
- Decisions: move scroll padding calc into BranchColumn scope to avoid SSR ReferenceError.
- Files: src/app/components/conversation/BranchColumn.tsx
- Notes: none
- Task: Keep active branch readable in split view (PRD: Core Experience > Branch navigation).
- Decisions: allow columns to shrink via min-w-0 and remove parent shrink lock to prevent overflow clipping.
- Files: src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationLayout.tsx
- Notes: none
2026-01-13 — Fix dev server port collision by pinning Vite to 5174 with strictPort. PRD: N/A. Decisions: avoid 5173 clash with croBuilder; force failure if occupied. Files: vite.config.mts.
2026-01-13 — UI redesign: new warm editorial theme, app-shell background, panel surfaces, refreshed sidebar/cards/messages, and floating centered composer in active branch. PRD: Core Experience > Branch navigation/composer placement; UX & A11y. Decisions: preserve all behaviors, increase scroll bottom padding for floating composer, keep popovers readable via light surfaces. Files: src/app/styles.css, src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationComposer.tsx, src/app/pages/conversation/ConversationSidebar.tsx, src/app/components/conversation/ConversationEmptyLayout.tsx, src/app/components/conversation/StreamingBubble.tsx, src/app/components/conversation/ToolInvocationSummary.tsx, src/app/components/conversation/BranchableMessage.tsx. Notes: Manual check—happy: sidebar toggle, branch switch, resize, send message, tools menu, model menu; failure: tool upload error display, search failure banner.
2026-01-13 — Empty state UX: clickable recent chats + centered composer-style start form (still only creates chat). PRD: Core Experience > Conversation management; UX & A11y. Decisions: preserve createConversation flow; input is decorative until chat opens. Files: src/app/components/conversation/ConversationEmptyLayout.tsx.
2026-01-13 — Theme shift to black/white base with blue primary + orange/red accent per request. PRD: UX & A11y. Decisions: monochrome surfaces with limited accent saturation. Files: src/app/styles.css.
2026-01-13 — Prevent active branch/composer squish: lower parent ratio, raise active min width, enable horizontal scroll when constrained, and keep floating composer full width on narrow columns. PRD: Core Experience > Branch navigation; UX & A11y. Decisions: preserve split behavior while keeping active column dominant. Files: src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx.
2026-01-13 — Enforce active column dominance: lower parent ratio, increase active min width, and prevent parent flex shrink. PRD: Core Experience > Branch navigation. Decisions: keep horizontal scroll when constrained; guarantee active width. Files: src/app/components/conversation/ConversationLayout.tsx.
2026-01-13 — Auto-collapse parent column when space is too tight to keep active branch/composer fully visible; widen floating composer container on narrow columns. PRD: Core Experience > Branch navigation. Decisions: preserve split UX, but force visibility at small widths. Files: src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx.
2026-01-13 — Split view fix: remove forced collapse/horizontal scroll, allow parent to shrink, and cap active min width to viewport so active content/composer stays visible while keeping resizer. PRD: Core Experience > Branch navigation. Decisions: active column never overflows viewport; parent yields space when constrained. Files: src/app/components/conversation/ConversationLayout.tsx.
2026-01-13 — Split sizing overhaul: compute usable width (minus resizer), set explicit parent/active widths to keep active within viewport, and restore centered composer max width. PRD: Core Experience > Branch navigation/composer placement. Decisions: parent width derived from clamped ratio; active never overflows viewport. Files: src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx.
2026-01-13 — Nudge active branch minimum width to 780px to stay slightly wider than composer. PRD: Core Experience > Branch navigation. Decisions: keep composer max width 720px. Files: src/app/components/conversation/ConversationLayout.tsx.
2026-01-13 — Tighten active/composer sizing: composer max width 680px + reduced horizontal padding; active min width 720px to stay slightly wider. PRD: Core Experience > Branch navigation/composer placement. Decisions: reduce perceived empty space while keeping desktop-friendly centered composer. Files: src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx.
2026-01-13 — Reduce active min width to 680px (slightly above 640px composer), allow more parent width via max ratio 0.48, and nudge default ratio to 0.34. PRD: Core Experience > Branch navigation/composer placement. Decisions: keep active dominant by default but allow tighter fit when resizing. Files: src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx.
2026-01-13 — Empty-state composer now boots new chat with first message + auto-send. PRD: Core Experience > Conversation management; UX & A11y. Decisions: stash draft in sessionStorage keyed by conversationId; consume once on layout mount and auto-send via composer for streaming/retry. Files: src/app/components/conversation/ConversationEmptyLayout.tsx, src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationComposer.tsx. Notes: Manual check—happy: home draft sends + streams on new chat; failure: send error leaves draft for retry.
2026-01-13 — Fix home auto-send bootstrap race so send triggers after value populates. PRD: Core Experience > Conversation management; UX & A11y. Decisions: wait until composer value is non-empty before comparing pending bootstrap message. Files: src/app/components/conversation/ConversationComposer.tsx. Notes: Browser test via Playwright against 192.168.50.134:5174 shows auto-send + streaming.
2026-01-13 — Composer model menu emojis for fast/reasoning tiers, right-aligned and small to avoid layout impact. PRD: UX & A11y; Core Experience > Conversation management. Decisions: fixed-width emoji badge, no check icon, rely on selected state styling. Files: src/app/components/conversation/ConversationComposer.tsx.
2026-01-13 — Fix Study & Learn agent by wiring OpenAI client into Agents SDK (uses env binding instead of process.env). PRD: Core Experience > Chat engine. Decisions: setDefaultOpenAIClient with ctx.getOpenAIClient per run to avoid missing API key in Workers. Files: src/app/shared/openai/studyAndLearnAgent.server.ts, src/app/pages/conversation/functions.ts. Notes: none.
- Task: Set GPT-5 response verbosity to low (PRD: model output verbosity).
- Decisions: Applied only to gpt-5* models via Responses options to avoid unsupported models; left other response calls unchanged.
- Files: src/app/pages/conversation/functions.ts.
- Notes: worker-configuration.d.ts has unrelated local modifications; left untouched.
2026-02-05 — Saved public beta launch plan doc + created planning branch. Ref: N/A (launch roadmap). Decisions: branch name `codex/public-beta-launch-plan`; plan stored in Docs for handoff. Files: Docs/public-beta-launch-plan.md, progress.txt. Notes: existing unrelated local change remains in worker-configuration.d.ts.
2026-02-05 — Phase1 slice A: decoupled focus collapse and persisted composer tools (fixes sidebar/parent collapse coupling + web-search reset on branch switch). Ref: Launch plan Phase1. Decisions: `focus=child` now auto-collapses parent only; initial collapse applied once per mount; selected tools persisted in sessionStorage per conversation. Files: src/app/pages/conversation/ConversationPage.tsx, src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/ConversationComposer.tsx, progress.txt. Notes: existing unrelated worker-configuration.d.ts left untouched.
2026-02-05 — Phase1 slice B: improved live streaming cadence + added tool/reasoning feedback events in streaming bubble. Ref: Launch plan Phase1. Decisions: reduce SSE publish threshold to 16 chars / 120ms; emit `tool_progress` and `reasoning_summary` over existing SSE channel; keep completion/error flow unchanged. Files: src/app/pages/conversation/functions.ts, src/app/components/conversation/StreamingBubble.tsx, progress.txt. Notes: reasoning summary best-effort from stream deltas and final response payload.

- Task: Audit conversation access patterns for auth/ownership risks (Verifier task). PRD: Docs/PRD.md (auth/ownership)
- Decisions: Highlighted lack of ownership checks; propose optional ownerId + lazy claim + directory filtering; keep legacy snapshots readable to avoid breakage.
- Files: src/app/pages/conversation/ConversationPage.tsx, src/app/pages/conversation/functions.ts, src/app/shared/conversationDirectory.server.ts, src/lib/durable-objects/ConversationDirectory.ts, src/app/shared/conversation.server.ts, src/app/shared/uploads.server.ts, src/app/shared/uploadsProxy.server.ts, src/lib/durable-objects/ConversationStore.ts, src/lib/conversation/model.ts, src/worker.tsx, src/app/context.ts
- Notes: Edge cases default conversation id, legacy records without owner, missing directory owner; guard strategy should claim-on-write.
2026-02-06 — Phase2 slice: auth identity context + per-user conversation ownership enforced server-side (including directory filtering and legacy owner claim). Ref: Docs/public-beta-launch-plan.md Phase2 items 1-2. Decisions: request identity resolves from auth headers or HttpOnly cookie fallback; default conversation id now user-scoped via resolver; snapshots without owner auto-claim to current user; directory DO now requires ownerId for list/mutate and filters per owner. Files: src/app/shared/auth.server.ts, src/app/context.ts, src/worker.tsx, src/lib/conversation/model.ts, src/lib/conversation/validation.ts, src/app/shared/conversation.server.ts, src/lib/durable-objects/ConversationDirectory.ts, src/app/shared/conversationDirectory.server.ts, src/app/pages/conversation/functions.ts, src/app/shared/uploads.server.ts, src/app/shared/uploadsProxy.server.ts, src/app/pages/conversation/ConversationPage.tsx, progress.txt. Notes: checks passed `pnpm types`, `npm run test`, `npm run lint`; manual validation notes—happy: new user cookie gets isolated conversation space; failure: owner mismatch throws access denied and directory excludes foreign conversation ids.

2026-02-06 scout pass quota demo (PRD: quotas/usage gating). Decisions: new AccountDO per user; reserve/commit/release per sendMessage stream; 10-pass default stored in DO with reservations. Files changed: progress.txt. Notes: design only, no code changes yet.
2026-02-06 — Phase2 slice: demo quota lane with reserve/commit/release semantics around sendMessage. Ref: Docs/public-beta-launch-plan.md Phase2 items 3 & 6 (partial). Decisions: add per-user AccountDO (10 total passes), reserve before generation, commit only on successful generation finalization, release on failures; return quota metadata from sendMessage for UI follow-up. Files: src/lib/durable-objects/Account.ts, src/app/shared/account.server.ts, src/app/context.ts, src/worker.tsx, src/app/pages/conversation/functions.ts, wrangler.jsonc, types/env.d.ts, progress.txt. Notes: checks passed `pnpm types`, `npm run test`, `npm run lint`; manual validation notes—happy: successful stream decrements remaining passes after commit; failure: reserve denial blocks generation and stream/finalization errors release reservations.
2026-02-06 — Verifier audit: OpenRouter routing risks (streaming, tools, settings) + guardrails/tests checklist. Ref: Docs/public-beta-launch-plan.md (OpenRouter routing). Decisions: enumerate incompatibilities (Responses stream events, web-search/tooling assumptions, model naming/effort heuristics); propose provider-capability registry and UI gating; list manual checks. Files: progress.txt. Notes: no code changes.
2026-02-06 — Phase2 slice: OpenRouter model selector + provider routing for sendMessage. Ref: Docs/public-beta-launch-plan.md Phase2 item 5 (partial) and Phase3 start-controls model selection. Decisions: model selector now includes server-fetched OpenRouter catalog (cached + auth-aware disable/fallback); models stored with `openrouter:` prefix for deterministic provider routing; sendMessage routes prefixed models through OpenRouter Responses client and keeps OpenAI defaults for non-prefixed models; web-search/reasoning gated by capability helpers to avoid invalid OpenRouter tool/reasoning usage. Files: src/app/shared/openrouterModels.server.ts, src/lib/openrouter/models.ts, src/lib/openai/models.ts, src/lib/openai/client.ts, src/worker.tsx, src/app/context.ts, src/app/pages/conversation/ConversationPage.tsx, src/app/components/conversation/ConversationLayout.tsx, src/app/components/conversation/BranchColumn.tsx, src/app/components/conversation/ConversationComposer.tsx, src/app/pages/conversation/functions.ts, types/env.d.ts, progress.txt. Notes: checks passed `pnpm types`, `npm run test`, `npm run lint`; manual validation—happy: OpenRouter models appear + selectable when OPENROUTER_API_KEY set and stream works; failure: missing/invalid OpenRouter key hides list or returns actionable send error.
